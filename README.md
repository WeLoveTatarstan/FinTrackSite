# FinTrackSite

## Версия alpha1.9

### Docker и контейнеризация

**Новые возможности:**
- ✅ **Dockerfile** - полная конфигурация для контейнеризации приложения
- ✅ **docker-compose.yml** - упрощенный запуск проекта в контейнере
- ✅ **Production-ready конфигурация** - использование Gunicorn вместо development сервера
- ✅ **WhiteNoise** - оптимизированная раздача статических файлов
- ✅ **Переменные окружения** - гибкая настройка через environment variables
- ✅ **Оптимизированная сборка** - многоступенчатая сборка Docker образа

**Технические улучшения:**
- Настроен Dockerfile на базе Python 3.11-slim
- Интеграция Gunicorn для production deployment
- WhiteNoise middleware для статических файлов
- Поддержка переменных окружения через `dj-database-url`
- Настроен `.dockerignore` для оптимизации сборки
- Автоматический сбор статических файлов при сборке образа

### Исправления CI/CD и нагрузочного тестирования

**Исправления:**
- ✅ **Исправлен синтаксис в load_test.js** - корректное использование шаблонных строк
- ✅ **Обновлена конфигурация k6-action** - удален неподдерживаемый параметр `summary`
- ✅ **Настроено сохранение результатов k6** - результаты сохраняются в JSON формате
- ✅ **Улучшена обработка артефактов** - добавлен `if-no-files-found: ignore`
- ✅ **Автоматическое создание директорий** - подготовка перед запуском тестов

**CI/CD улучшения:**
- Исправлены конфликты в workflow файлах
- Настроен корректный вывод результатов нагрузочных тестов
- Улучшена обработка ошибок в pipeline
- Оптимизирована структура GitHub Actions workflow

## Версия alpha1.8

### Обновление дизайна страниц

**Новые возможности:**
- ✅ **Темная тема для страницы "О нас"** - полное обновление под новый дизайн
- ✅ **Темная тема для страницы "Профиль"** - современный дизайн с голубыми акцентами
- ✅ **Единообразный дизайн** - все страницы теперь соответствуют общему стилю
- ✅ **Голубые акценты** - консистентное использование #1d5cff по всему сайту
- ✅ **Улучшенные формы** - темные поля ввода с голубыми границами
- ✅ **Адаптивная верстка** - корректное отображение на всех устройствах

**Дизайн-изменения:**
- Обновлена цветовая схема для страницы "О нас"
- Темные карточки с голубыми границами
- Обновлены формы профиля под темную тему
- Голубые акценты для всех интерактивных элементов
- Улучшена читаемость текста на темном фоне

**Технические улучшения:**
- Обновлены CSS стили для обеих страниц
- Консистентная цветовая схема (#1a1a1a, #2d2d2d, #1d5cff)
- Улучшены hover-эффекты и анимации
- Адаптивная верстка для мобильных устройств

## CI/CD и надежность

**Автоматизация:**
- GitHub Actions (`.github/workflows/ci.yml`) автоматически выполняет:
  1. **tests** - unit и интеграционные тесты Django
  2. **load-test** - нагрузочное тестирование с k6
  3. **deploy** - сборка и публикация Docker образа в GHCR
- Dockerfile и docker-compose.yml позволяют запускать проект локально или в облаке
- Контейнерный образ публикуется в GHCR (`ghcr.io/<org>/<repo>/fintrack:<sha>`)
- Эндпойнты `/health/` и `/metrics/` облегчают подключение мониторинга (Prometheus/Grafana)

**Особенности CI/CD:**
- Автоматический запуск на push в `main` и при создании PR
- Кэширование зависимостей pip для ускорения сборки
- Сохранение результатов нагрузочных тестов как артефакты
- Автоматическая проверка готовности сервера перед тестами
- Поддержка ручного запуска через `workflow_dispatch`

### Как включить GitHub Actions

1. **Настройте доступ к репозиторию:**
   
   **Вариант A: Использовать HTTPS с Personal Access Token (проще)**
   ```bash
   # Переключите remote на HTTPS
   git remote set-url origin https://github.com/WeLoveTatarstan/FinTrackSite.git
   
   # При следующем push Git запросит логин и пароль
   # Используйте Personal Access Token вместо пароля:
   # GitHub → Settings → Developer settings → Personal access tokens → Generate new token (classic)
   # Выберите права: repo (полный доступ к репозиториям)
   ```
   
   **Вариант B: Настроить SSH-ключ (для постоянного использования)**
   ```bash
   # Проверьте, есть ли уже SSH-ключ
   ls -al ~/.ssh
   
   # Если нет, создайте новый ключ
   ssh-keygen -t ed25519 -C "your_email@example.com"
   
   # Скопируйте публичный ключ
   cat ~/.ssh/id_ed25519.pub
   
   # Добавьте ключ в GitHub:
   # Settings → SSH and GPG keys → New SSH key → вставьте содержимое
   
   # Убедитесь, что remote использует SSH
   git remote set-url origin git@github.com:WeLoveTatarstan/FinTrackSite.git
   ```

2. Запушьте ветку с файлом `.github/workflows/ci.yml` в репозиторий на GitHub:
   ```bash
   git add .
   git commit -m "Add CI/CD pipeline"
   git push origin main
   ```

3. В настройках репозитория перейдите в **Settings → Actions → General** и убедитесь, что Actions разрешены для всех воркфлоу.

4. Если потребуется деплой в облако, добавьте секреты в **Settings → Secrets and variables → Actions**:
   - `PRODUCTION_DATABASE_URL`, `DJANGO_SECRET_KEY`, `CLOUD_DEPLOY_TOKEN` и т.п. (по необходимости).

5. После пуша проверьте вкладку **Actions** — workflow "CI/CD Pipeline" должен состоять из трёх job (tests, load-test, deploy) и проходить на ветке `main`.

6. Для ручного запуска используйте кнопку **Run workflow** на странице Actions (workflow поддерживает `workflow_dispatch`).

### Как запустить тесты

```bash
python -m pip install -r requirements.txt
python manage.py migrate
python manage.py test
```

### Нагрузочные тесты

```bash
python manage.py runserver  # в отдельном терминале
k6 run tests/perf/load_test.js
```

### Мониторинг

- `/health/` — JSON-проверка статуса приложения и подключения к БД.
- `/metrics/` — Prometheus-метрики (`fintrack_request_latency_seconds`, `fintrack_request_total`, `fintrack_active_clients`, и др.).

Добавьте таргет в Prometheus:

```yaml
scrape_configs:
  - job_name: fintrack
    metrics_path: /metrics/
    static_configs:
      - targets: ["fintrack.example.com"]
```

### Переменные окружения

| Переменная | Назначение |
|-----------|------------|
| `DJANGO_SECRET_KEY` | секретный ключ Django |
| `DJANGO_DEBUG` | `True/False` |
| `DJANGO_ALLOWED_HOSTS` | список доменов через запятую |
| `DJANGO_CSRF_TRUSTED_ORIGINS` | домены для CSRF |
| `DJANGO_LOG_LEVEL` | уровень логирования (по умолчанию INFO) |
| `DATABASE_URL` | строка подключения (по умолчанию SQLite) |

### Docker

**Локальный запуск с Docker Compose:**
```bash
docker-compose up --build
```

**Сборка Docker образа:**
```bash
docker build -t fintrack:latest .
docker run -p 8000:8000 \
  -e DJANGO_SECRET_KEY=your-secret-key \
  -e DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1 \
  fintrack:latest
```

**Применение миграций в контейнере:**
```bash
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```

---

## Используемые технологии

### Backend
- **Python 3.11** - язык программирования
- **Django 4.2.24** - веб-фреймворк
- **Gunicorn 22.0.0** - WSGI HTTP сервер для production
- **WhiteNoise 6.7.0** - раздача статических файлов
- **Pillow 10.4.0** - обработка изображений
- **dj-database-url 2.3.0** - парсинг URL базы данных
- **prometheus-client 0.21.0** - метрики для мониторинга

### База данных
- **SQLite** - база данных по умолчанию (development)
- Поддержка PostgreSQL, MySQL через `DATABASE_URL`

### DevOps и CI/CD
- **Docker** - контейнеризация приложения
- **Docker Compose** - оркестрация контейнеров
- **GitHub Actions** - автоматизация CI/CD
- **k6** - нагрузочное тестирование
- **GHCR (GitHub Container Registry)** - хранение Docker образов

### Мониторинг и метрики
- **Prometheus** - сбор метрик
- **Health Check Endpoint** (`/health/`) - проверка состояния приложения
- **Metrics Endpoint** (`/metrics/`) - Prometheus метрики

### Frontend
- **HTML5/CSS3** - разметка и стили
- **JavaScript (ES6+)** - клиентская логика
- **Адаптивный дизайн** - поддержка мобильных устройств

### Инфраструктура
- **Git** - система контроля версий
- **GitHub** - хостинг репозитория и CI/CD
- **Render/Any PaaS** - платформы для деплоя (опционально)

---

## Предыдущие версии

### Версия alpha1.7
- Автоматическое создание клиентов - все пользователи автоматически становятся клиентами
- Базовый уровень доступа - все новые пользователи получают базовую подписку
- Упрощенная регистрация - единый процесс регистрации для всех пользователей
- Сигналы Django - автоматическое создание клиентов при регистрации
- Миграция данных - обновление существующих пользователей
- Улучшенная логика - упрощение различий между профилями и клиентами

### Версия alpha1.6
- Кастомная админка - полностью переработанная панель администратора
- Темная тема админки - соответствует дизайну основного сайта
- Статистика на главной - отображение ключевых метрик системы
- Модульная навигация - удобные карточки для быстрого доступа
- Последние действия - лента активности в системе
- Адаптивный дизайн - корректная работа на всех устройствах
- Сохранение стандартной админки - доступ к Django admin по /django-admin/

### Версия alpha1.5
- Темная тема - применена ко всему сайту для современного вида
- Сетка новостей - адаптивная сетка с карточками новостей
- Затычки для разработки - демонстрационные новости в режиме разработки
- Бесконечная прокрутка - автоматическая загрузка новостей при прокрутке
- Анимированный загрузчик - спиннер при загрузке новых новостей
- Интерактивные карточки - клик по новости для перехода к статье
- Адаптивный дизайн - корректное отображение на всех устройствах

### Версия alpha1.4
- Поиск валют - текстовый поиск по коду валюты с мгновенным результатом
- Сортировка валют - возможность сортировки по коду и курсу
- Пагинация - отображение валют по 5 штук на странице с навигацией
- Динамическое управление - все функции работают без перезагрузки страницы

### Версия alpha1.3
- Базовая функциональность конвертера валют
- Статичные курсы валют
- Отображение драгоценных металлов